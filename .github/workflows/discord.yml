name: "Notificar no Discord - Front-End"

on:
  push:
    branches: [ main ]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
    - name: Verificar se o webhook est√° setado
      run: |
        if [ -z "${{ secrets.DISCORD_WEBHOOK }}" ]; then
          echo "‚ö†Ô∏è DISCORD_WEBHOOK est√° vazio"
          exit 1
        else
          echo "‚úÖ DISCORD_WEBHOOK est√° configurado"
        fi

    - name: Enviar notifica√ß√£o para o Discord (Front-End)
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      run: |
        COMMIT_URL="${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}"
        COMMIT_MSG="${{ github.event.head_commit.message }}"
        DATA_HORA=$(TZ=America/Sao_Paulo date "+%a %d %b %Y %T %Z")

        curl -H "Content-Type: application/json" \
        -X POST \
        -d "{
          \"embeds\": [{
            \"title\": \"üé® Atualiza√ß√£o no Front-End\",
            \"description\": \"**${{ github.actor }}** enviou um novo commit para o reposit√≥rio **${{ github.repository }}**.\n\nüí¨ **Mensagem do commit:**\n\\\${COMMIT_MSG}\\\\",
            \"color\": 3447003,
            \"fields\": [
              {
                \"name\": \"üîó Commit\",
                \"value\": \"[Ver commit](${COMMIT_URL})\"
              },
              {
                \"name\": \"üì¶ Branch\",
                \"value\": \"${{ github.ref_name }}\",
                \"inline\": true
              },
              {
                \"name\": \"üïí Hora\",
                \"value\": \"${DATA_HORA}\",
                \"inline\": true
              }
            ],
            \"footer\": {
              \"text\": \"Front-end com novidades fresquinhas üíÖ‚ú®\"
            }
          }]
        }" \
        "$DISCORD_WEBHOOK"
