name: Notificar no Discord - Front-End

on:
  push:
    branches: [ main ]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Configurar locale pt_BR.UTF-8
        run: |
          sudo apt-get update
          sudo apt-get install -y locales
          sudo locale-gen pt_BR.UTF-8

      - name: Enviar notifica√ß√£o para o Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          COMMIT_URL="${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}"
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          COMMIT_SHA="${{ github.sha }}"
          AUTOR="${{ github.actor }}"
          BRANCH="${{ github.ref_name }}"
          REPO="${{ github.repository }}"
          DATA_HORA=$(LC_TIME=pt_BR.UTF-8 TZ=America/Sao_Paulo date "+%A, %d de %B de %Y √†s %H:%M:%S (%Z)")
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)

          PAYLOAD=$(cat <<EOF
{
  "username": "GitHub Actions | Front-End",
  "avatar_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",
  "embeds": [
    {
      "title": "üöÄ Novo commit no Front-End",
      "description": "**${AUTOR}** realizou um push no reposit√≥rio **${REPO}**.",
      "color": 3066993,
      "fields": [
        {
          "name": "üìù Mensagem do Commit",
          "value": "\`\`\`${COMMIT_MSG}\`\`\`"
        },
        {
          "name": "üîó Commit",
          "value": "[Ver commit](${COMMIT_URL})",
          "inline": true
        },
        {
          "name": "üì¶ Branch",
          "value": "${BRANCH}",
          "inline": true
        },
        {
          "name": "üïí Data",
          "value": "${DATA_HORA}",
          "inline": true
        },
        {
          "name": "üîê SHA",
          "value": "\`${COMMIT_SHA:0:7}\`",
          "inline": true
        }
      ],
      "footer": {
        "text": "Monitoramento autom√°tico via GitHub Actions",
        "icon_url": "https://cdn-icons-png.flaticon.com/512/25/25231.png"
      },
      "timestamp": "${TIMESTAMP}"
    }
  ]
}
EOF
)

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "${PAYLOAD}" \
               "$DISCORD_WEBHOOK"
